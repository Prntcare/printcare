<script>
/* --- Slider Logic --- */
let slideIndex = 0;
const slides = document.querySelectorAll('.slides img');
function showSlides(){
    slides.forEach((img,i)=> img.style.display = 'none');
    slideIndex++;
    if(slideIndex > slides.length) slideIndex = 1;
    slides[slideIndex-1].style.display = 'block';
    setTimeout(showSlides, 4000);
}
showSlides();

/* --- Gallery Lightbox --- */
const galleryContainer = document.getElementById('gallery-container');
galleryContainer.addEventListener('click', e => {
    if(e.target.tagName === 'IMG') window.open(e.target.src,'_blank');
});

/* --- Admin Upload Functionality with Live Preview & Progress --- */
const logoInput = document.getElementById('upload-logo');
const galleryInput = document.getElementById('upload-gallery');
const saveBtn = document.getElementById('save-changes');
const logoImg = document.getElementById('logo');

logoInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onloadstart = () => console.log('Logo upload started...');
        reader.onload = function(evt){
            logoImg.src = evt.target.result;
            console.log('Logo upload complete');
        }
        reader.readAsDataURL(file);
    }
});

galleryInput.addEventListener('change', e => {
    const files = Array.from(e.target.files);
    files.forEach(file => {
        const reader = new FileReader();
        const progress = document.createElement('p');
        progress.textContent = `Uploading ${file.name}...`;
        galleryContainer.appendChild(progress);
        reader.onload = function(evt){
            const img = document.createElement('img');
            img.src = evt.target.result;
            galleryContainer.appendChild(img);
            img.addEventListener('click', ()=> window.open(img.src,'_blank'));
            progress.remove();
        }
        reader.readAsDataURL(file);
    });
});

saveBtn.addEventListener('click', ()=>{
    alert('Changes applied locally (for persistence, backend required).');
});

/* --- AI Assistant Integration (Styled & Scrollable) --- */
const sendBtn = document.getElementById('send-ai');
const aiTextarea = document.querySelector('#ai-widget textarea');
const aiResponse = document.getElementById('ai-response');

aiResponse.style.maxHeight = '200px';
aiResponse.style.overflowY = 'auto';
aiResponse.style.padding = '5px';
aiResponse.style.backgroundColor = '#111';
aiResponse.style.borderRadius = '5px';
aiResponse.style.fontSize = '0.9rem';
aiResponse.style.color = '#fff';
aiResponse.style.lineHeight = '1.4';

sendBtn.addEventListener('click', async ()=>{
    const prompt = aiTextarea.value.trim();
    if(!prompt) return;

    aiResponse.innerHTML += `<p><strong>You:</strong> ${prompt}</p>`;
    aiTextarea.value = '';
    
    const thinkingPara = document.createElement('p');
    thinkingPara.innerHTML = '<strong>AI:</strong> Thinking...';
    aiResponse.appendChild(thinkingPara);
    aiResponse.scrollTop = aiResponse.scrollHeight;

    try{
        const res = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer YOUR_OPENAI_API_KEY' // Replace with your key
            },
            body: JSON.stringify({
                model: 'gpt-3.5-turbo',
                messages: [{ role: 'user', content: prompt }]
            })
        });
        const data = await res.json();
        thinkingPara.innerHTML = `<strong>AI:</strong> ${data.choices[0].message.content}`;
        aiResponse.scrollTop = aiResponse.scrollHeight;
    } catch(err){
        thinkingPara.innerHTML = '<strong>AI:</strong> Error connecting to AI.';
        aiResponse.scrollTop = aiResponse.scrollHeight;
    }
});
</script>
